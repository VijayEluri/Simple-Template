<!--
/*
 *   Copyright 2010 Jalian Systems Pvt. Ltd.
 *
 *   Licensed under the Apache License, Version 2.0 (the "License");
 *   you may not use this file except in compliance with the License.
 *   You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 *   Unless required by applicable law or agreed to in writing, software
 *   distributed under the License is distributed on an "AS IS" BASIS,
 *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *   See the License for the specific language governing permissions and
 *   limitations under the License.
*/
-->

<project name='simple-template' default='deploy' basedir='.'>
	<property name="simpletemplate-version" value="1.0" />
	<property name="junit.jar" location="/usr/share/java/junit-4.6/junit.jar"/>
	<property name="report.dir" location="test-reports"/>

	<target name='clean'>
        <delete dir='ant-target'/>
        <delete file="simpletemplate.jar"/>
	</target>

	<target name='clean-all' depends='clean'>
        <delete file="simpletemplate-${simpletemplate-version}.zip"/>
	</target>

	<property name="class.dir" location="ant-target/classes"/>
	<property name="tests.dir" location="ant-target/test-classes"/>

	<path id="tests-classpath">
		<pathelement location="${class.dir}"/>
		<pathelement location="${tests.dir}"/>
		<pathelement location="${junit.jar}"/>
	</path>

    <target name='compile-tests' description="Compiles all the test sources">
        <mkdir dir='${tests.dir}'/>
        <copy todir='${tests.dir}'>
            <fileset dir='test' excludes='**/*.java'/>
        </copy>
        <javac destdir='${tests.dir}' debug='on' optimize='off' deprecation='on'>
            <src path='test'/>
			<classpath refid="tests-classpath"/>
        </javac>
	</target>

    <target name='compile' description="Compiles all the sources">
        <mkdir dir='${class.dir}'/>
        <copy todir='${class.dir}'>
            <fileset dir='src' excludes='**/*.java'/>
        </copy>
        <javac destdir='${class.dir}' debug='on' optimize='off' deprecation='on'>
            <src path='src'/>
        </javac>
	</target>

	<target name='tests' depends="compile-tests" description="Runs all unit tests">
		<ant dir="ant-tool" inheritAll="true">
			<reference refid="tests-classpath" torefid="classpath"/>
			<property name="source.dir" location="test"/>
			<property name="file.pattern" value=".*Test.java"/>
			<property name="report.dir" location="report"/>
		</ant>
	</target>

	<target name='tests-old' depends="compile-tests" description="Runs all unit tests">
		<ant dir="ant-tool" inheritAll="true">
			<reference refid="tests-classpath" torefid="classpath"/>
			<property name="source.dir" location="test"/>
			<property name="file.pattern" value=".*Test.java"/>
		</ant>
	</target>

    <target name='build' depends='compile, tests' description="Builds all the dependent jars">
		<jar jarfile='simpletemplate.jar' basedir='ant-target/classes'/>
	</target>

    <target name='zip' depends='build' description="Creates the compressed distribution files">
        <delete file="simpletemplate-${simpletemplate-version}.zip"/>
        <zip destfile="simpletemplate-${simpletemplate-version}.zip">
            <zipfileset dir='.' prefix='simpletemplate-${simpletemplate-version}'>
                <include name="simpletemplate.jar"/>
				<include name="README"/>
				<include name="LICENSE.txt"/>
            </zipfileset>
		</zip>
	</target>

    <target name='deploy' depends='zip, clean' description="Generate files for deployment">
	</target>
</project>
